"use strict";(self["webpackChunk_coreui_coreui_free_vue_admin_template"]=self["webpackChunk_coreui_coreui_free_vue_admin_template"]||[]).push([[348],{5348:function(e,t,o){o.r(t),o.d(t,{default:function(){return y}});o(7658);var l=o(3396),a=o(4870),n=o(7139),s=o(65),c=o(6780),r=o(8514),d=o(4854),u={name:"Column",props:{columnKey:{type:null,default:null},field:{type:[String,Function],default:null},sortField:{type:[String,Function],default:null},filterField:{type:[String,Function],default:null},dataType:{type:String,default:"text"},sortable:{type:Boolean,default:!1},header:{type:null,default:null},footer:{type:null,default:null},style:{type:null,default:null},class:{type:String,default:null},headerStyle:{type:null,default:null},headerClass:{type:String,default:null},bodyStyle:{type:null,default:null},bodyClass:{type:String,default:null},footerStyle:{type:null,default:null},footerClass:{type:String,default:null},showFilterMenu:{type:Boolean,default:!0},showFilterOperator:{type:Boolean,default:!0},showClearButton:{type:Boolean,default:!0},showApplyButton:{type:Boolean,default:!0},showFilterMatchModes:{type:Boolean,default:!0},showAddButton:{type:Boolean,default:!0},filterMatchModeOptions:{type:Array,default:null},maxConstraints:{type:Number,default:2},excludeGlobalFilter:{type:Boolean,default:!1},filterHeaderClass:{type:String,default:null},filterHeaderStyle:{type:null,default:null},filterMenuClass:{type:String,default:null},filterMenuStyle:{type:null,default:null},selectionMode:{type:String,default:null},expander:{type:Boolean,default:!1},colspan:{type:Number,default:null},rowspan:{type:Number,default:null},rowReorder:{type:Boolean,default:!1},rowReorderIcon:{type:String,default:"pi pi-bars"},reorderableColumn:{type:Boolean,default:!0},rowEditor:{type:Boolean,default:!1},frozen:{type:Boolean,default:!1},alignFrozen:{type:String,default:"left"},exportable:{type:Boolean,default:!0},exportHeader:{type:String,default:null},exportFooter:{type:String,default:null},filterMatchMode:{type:String,default:null},hidden:{type:Boolean,default:!1}},render(){return null}};class i{getCustomersSmall(){return fetch("customers-small.json").then((e=>e.json())).then((e=>e.data))}getCustomersMedium(){return fetch("customers-medium.json").then((e=>e.json())).then((e=>e.data))}getCustomersLarge(){return fetch("customers-large.json").then((e=>e.json())).then((e=>e.data))}getCustomersXLarge(){return fetch("customers-xlarge.json").then((e=>e.json())).then((e=>e.data))}getCustomers(e){const t=e?Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&"):"";return fetch("https://www.primefaces.org/data/customers?"+t).then((e=>e.json()))}}var g=o(3208);const p=["alt","src"];var f=(0,l.aZ)({__name:"StockAdmin",setup(e){const t=["日","月","火","水","木","金","土"];let o=(0,a.iH)("8fB3jlS28Bd5LjtoDHdVu8LhxpX2"),f="Restaurant",m=[];(0,l.bv)((()=>{C(),j()}));const y=(0,a.iH)([]),h=(0,a.iH)([]),k=((0,a.iH)(new i),(0,a.iH)([])),D=e=>{let{data:t,newValue:o,field:l}=e;console.log("data : ",t),console.log("newValue : ",o),console.log("field : ",l),isNaN(o)||null==o?alert("在庫数は半角数字で入力してください！"):t[l]=o};let v=()=>new Promise(((e,t)=>{console.log("judgeMainMenuOrNot");let l={},a=c.Z.firestore().collection(f).doc(o.value);a.get().then((function(t){if(t.exists){console.log("doc.id : ",t.id),console.log("doc.data() : ",t.data()),console.log("doc.data()['menu_map'] : ",t.data()["menu_map"]);let o=t.data()["menu_map"];o.forEach(((e,t)=>{console.log("i : ",t),console.log("value : ",e),console.log("Object.keys(value) : ",Object.keys(e)[0]);let o=Object.keys(e)[0];console.log("value[key] : ",e[o]),console.log('value[key]["img_path"] : ',e[o]["img_path"]),l[o]=e[o]["img_path"]})),console.log("after_aftermenuMapArray : ",o),e(l)}})).catch((function(e){t(),console.log("Error getting document:",e)}))})),w=e=>{let t=new Date;const o=[],l=31;for(let a=0;a<l;a++)console.log("i = "+a),t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+a,0,0,0,0),o.push(t);return o};const S=e=>(console.log("deleteOldStockDoc"),new Promise(((t,l)=>{for(let a=0;a<e.length;a++){let t=c.Z.firestore().collection(f).doc(o.value).collection("stocks").doc(e[a]);t.delete().then((()=>{})).catch((e=>{console.log(`Falied to delete DB (${e})`),l()}))}t(!0)})));function b(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()-1,e.getHours(),e.getMinutes(),e.getMinutes(),e.getMilliseconds());return console.log("baseDate : ",t),new Promise(((e,l)=>{let a=c.Z.firestore().collection(f).doc(o.value).collection("stocks").where("targetDate","<=",t);a.get().then((t=>{console.log("snapshot : ",t);let o=[];t.forEach((e=>{e.exists?(console.log("doc.id : ",e.id),console.log("doc.data() : ",e.data()),console.log("doc.data()['stocks'] : ",e.data()["stocks"]),console.log("doc.data()['targetDate'] : ",e.data()["targetDate"]),o.push(e.id)):console.log("DBG15_No such document!")})),e(o)})).catch((function(e){l(),console.log("Error getting document:",e)}))}))}function _(e){return new Promise(((t,l)=>{console.log("filterIntoOnlyNonExistDateArray");let a=c.Z.firestore().collection(f).doc(o.value).collection("stocks");a.get().then((o=>{console.log("snapshot : ",o);let l=e.map((e=>e.getTime()));console.log("targetTimeList : ",l),o.forEach((t=>{t.exists?(console.log("doc.data()['targetDate'].toDate() : ",t.data()["targetDate"].toDate()),console.log("targetGeneratedArray[0] == doc.data()['targetDate'].toDate()  : ",e[0]==t.data()["targetDate"].toDate()),console.log("targetGeneratedArray[0] === doc.data()['targetDate'].toDate()  : ",e[0]===t.data()["targetDate"].toDate()),console.log("doc.data()['targetDate'].toDate().getTime() : ",t.data()["targetDate"].toDate().getTime()),console.log("targetGeneratedArray[0].getTime() : ",e[0].getTime()),console.log("targetGeneratedArray[0].getTime() == doc.data()['targetDate'].toDate().getTime())  : ",e[0].getTime()==t.data()["targetDate"].toDate().getTime()),console.log("targetTimeList.includes(doc.data()['targetDate'].toDate().getTime()) : ",l.includes(t.data()["targetDate"].toDate().getTime())),l=l.filter((e=>e!==t.data()["targetDate"].toDate().getTime()))):console.log("DBG15_No such document!")}));const a=l.map((e=>new Date(e)));console.log("filteredIntoOnlyToBeAddedTimeList: ",a),t(a)})).catch((function(e){l(),console.log("Error getting document:",e)}))}))}function B(){return new Promise(((e,t)=>{console.log("generateStocksArray");let l=c.Z.firestore().collection(f).doc(o.value);l.get().then((function(t){if(t.exists){console.log("doc.id : ",t.id),console.log("doc.data() : ",t.data()),console.log("doc.data()['stocks'] : ",t.data()["stocks"]);let o=t.data()["stocks"];o.forEach(((e,t)=>{console.log("i : ",t),console.log("value : ",e),o[t]["stock"]=0})),console.log("after_afterStocksArray : ",o),e(o)}})).catch((function(t){e(m),console.log("Error getting document:",t)}))}))}const C=async()=>{console.log("updateLatestDays"),console.log("addToFullStockArrayDoc");let e=new Date;const t=w(e);console.log("targetGeneratedArray : ",t);const o=await b();console.log("docToBeDeletedArray : ",o);const l=await S(o);console.log("checkCode1 : ",l);const a=await _(t);console.log("onlyNonExistDateArray : ",a);const n=await B();console.log("returned_stocksArray : ",n)},j=async()=>{const e=await v();console.log("menuMapImgObj : ",e);let l=c.Z.firestore().collection(f).doc(o.value).collection("stocks");await l.orderBy("targetDate","asc").get().then((async o=>{let l=0,a=[];o.forEach((o=>{console.log("doc.id : ",o.id),console.log("doc : ",o),console.log("doc.data() : ",o.data());let a=o.data()["targetDate"].toDate();console.log("date : ",a),console.log("date.getFullYear() : ",a.getFullYear()),console.log("date.getMonth() + 1 : ",a.getMonth()+1),console.log("date.getDate() : ",a.getDate()),h.value.push({docId:o.id,contents:{targetDate:o.data()["targetDate"],createdAt:o.data()["createdAt"],stocks:[]}});let n={},s=0;0==l&&0==s&&k.value.push({field:"number",header:"No."},{field:"item",header:"商品"});let c=String(a.getMonth()+1)+"/"+String(a.getDate())+"\n("+t[a.getDay()]+")";k.value.push({field:"day"+String(l+1),header:c});let r=[];o.data()["stocks"].forEach(((t,a)=>{if(console.log("item : ",t),0==l){let o="";-1!==Object.keys(e).indexOf(t["stock_selection"])?(console.log("Exist"),o=e[t["stock_selection"]]):(console.log("not Exist"),o="https://www.primefaces.org/wp-content/uploads/2020/05/placeholder.png"),y.value.push({number:s+1,item:t["stock_selection"],image:o})}y.value[s]["day"+String(l+1)]=t["stock"],r.push({number:l+1,item:t["stock_selection"],docId:o.id}),n["stock"]=t["stock"],s+=1}));const d=Object.assign(r,n);console.log("mergedObj : ",d),console.log("stocks.value : ",y.value),console.log("docCount : ",l),l+=1})),console.log("itemArray : ",a)}))},A=e=>new URL(e,"file:///Users/k/Google%E3%83%88%E3%82%99%E3%83%A9%E3%82%A4%E3%83%95%E3%82%99/01_Sync/GADANDAN/01_eBENTO/01_PJ/gadandan-cake-system/public/adminDashboad/src/views/app/StockAdmin.vue%3Fvue&type=script&setup=true&lang=ts").href,E=async()=>{console.log("updateStocks"),console.log("stocks.value : ",y.value),console.log("objForUpdateStocks.value : ",h.value),y.value.forEach((e=>{console.log("value : ",e),console.log('value["day1"] : ',e["day1"]),console.log('value["day2"] : ',e["day2"]),console.log("objForUpdateStocks.value : ",h.value),console.log("objForUpdateStocks.value[0] : ",h.value[0]),console.log('objForUpdateStocks.value[0]["contents"] : ',h.value[0]["contents"]),console.log('objForUpdateStocks.value[0]["contents"]["stocks"] : ',h.value[0]["contents"]["stocks"]);for(let t=0;t<31;t++)h.value[t]["contents"]["stocks"].push({stock:e["day"+String(t+1)],stock_selection:e["item"]})})),console.log("objForUpdateStocks.value : ",h.value);let e=c.Z.firestore().batch();h.value.forEach(((t,l)=>{console.log("objForUpdateStocks.value[index] : ",h.value[l]);let a=c.Z.firestore().collection(f).doc(o.value).collection("stocks").doc(h.value[l]["docId"]);e.update(a,h.value[l]["contents"])})),e.commit().then((()=>{console.log("Batch write Success.")}))},M=(0,s.oR)();return console.log("store : ",M),(e,t)=>{const o=(0,l.up)("Dialog");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l.Wm)(o),(0,l._)("button",{onClick:t[0]||(t[0]=e=>C())},"updateLatestDays"),(0,l._)("button",{onClick:t[1]||(t[1]=e=>j())},"extractRestaurant"),(0,l._)("button",{onClick:t[2]||(t[2]=e=>(0,a.SU)(v)())},"judgeMainMenuOrNot"),(0,l.Wm)((0,a.SU)(g.x),null,{default:(0,l.w5)((()=>[(0,l.Wm)((0,a.SU)(d.Z),{value:y.value,responsiveLayout:"scroll",editMode:"cell",rowEditor:"",loading:e.loading,scrollDirection:"both",showGridlines:"",stripedRows:"",scrollHeight:"flex",class:"p-datatable-sm",onCellEditComplete:D},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(k.value,((e,t)=>((0,l.wg)(),(0,l.j4)((0,a.SU)(u),{field:e.field,header:e.header,key:e.field,class:(0,n.C_)({"sunday-table":e.header.match(/日/)}),inputClass:"edit-stock-number-ui"},(0,l.Nv)({editor:(0,l.w5)((({data:e,field:t})=>[(0,l.Wm)((0,a.SU)(r.Z),{modelValue:e[t],"onUpdate:modelValue":o=>e[t]=o,showButtons:"",buttonLayout:"horizontal",step:1,decrementButtonClass:"my-plus-button",incrementButtonClass:"my-minus-button",incrementButtonIcon:"pi pi-plus",decrementButtonIcon:"pi pi-minus",mode:"decimal",min:0,inputClass:"input-number-box"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},[1==t?{name:"body",fn:(0,l.w5)((({data:e,field:t})=>[(0,l._)("img",{alt:t,src:A(e["image"]),width:"30",height:"30",style:{"vertical-align":"middle"}},null,8,p),(0,l.Uk)((0,n.zw)(e[t]),1)])),key:"0"}:void 0]),1032,["field","header","class"])))),128))])),_:1},8,["value","loading"])])),_:1}),(0,l._)("button",{onClick:t[3]||(t[3]=e=>E())},"updateStocks")])}}});const m=f;var y=m}}]);
//# sourceMappingURL=348.24924cbd.js.map